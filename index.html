<!DOCTYPE html>
<html>
<head>
  <title>4-LED Control Panel</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f0f0f0;
    }
    .led-card {
      background: white;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 20px;
      box-shadow: 0 0 10px #ccc;
    }
    h2 {
      margin-bottom: 5px;
    }
    label {
      display: inline-block;
      width: 100px;
    }
    input {
      margin: 5px 0;
    }
    button {
      margin-top: 10px;
      padding: 5px 15px;
      background: green;
      color: white;
      border: none;
      border-radius: 4px;
    }
  </style>
</head>
<body>
  <h1>LED Control Panel (ThingSpeak)</h1>

  <div id="leds"></div>

  <script>
    const channelID = "2986528";
    const writeAPIKey = "A8BTENFZMSX9E6H2";

    const ledCount = 4;

    const container = document.getElementById('leds');

    for (let i = 1; i <= ledCount; i++) {
      const card = document.createElement('div');
      card.className = 'led-card';
      card.innerHTML = `
        <h2>LED ${i}</h2>
        <label>ON Time:</label><input type="time" id="on${i}" required><br>
        <label>OFF Time:</label><input type="time" id="off${i}" required><br>
        <label>Intensity:</label><input type="number" id="intensity${i}" min="0" max="255" required><br>
        <button onclick="submitData(${i})">Send to ThingSpeak</button>
        <div id="msg${i}" style="color: green; margin-top: 5px;"></div>
      `;
      container.appendChild(card);
    }

    function submitData(ledNum) {
      const on = document.getElementById(`on${ledNum}`).value;
      const off = document.getElementById(`off${ledNum}`).value;
      const intensity = document.getElementById(`intensity${ledNum}`).value;
      const message = document.getElementById(`msg${ledNum}`);

      if (!on || !off || intensity === '') {
        alert("Please fill all fields");
        return;
      }

      const data = `${on},${off},${intensity}`;
      const fieldName = `field${ledNum}`;
      const url = `https://api.thingspeak.com/update?api_key=${writeAPIKey}&${fieldName}=${encodeURIComponent(data)}`;

      fetch(url)
        .then(res => res.text())
        .then(response => {
          if (parseInt(response) > 0) {
            message.innerText = "✅ Updated successfully!";
            message.style.color = "green";
          } else {
            message.innerText = "❌ Failed to update.";
            message.style.color = "red";
          }
        })
        .catch(err => {
          console.error(err);
          message.innerText = "❌ Network Error.";
          message.style.color = "red";
        });
    }
  </script>
</body>
</html>
